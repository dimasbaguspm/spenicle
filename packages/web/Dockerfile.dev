# Development Dockerfile for local use
FROM node:22-alpine

# Accept build arguments for environment variables
ARG NODE_ENV=development
ARG WEB_PORT=8080
ARG WEB_STAGE=development
ARG API_BASE_URL

# Set environment variables
ENV NODE_ENV=${NODE_ENV}
ENV WEB_PORT=${WEB_PORT}
ENV WEB_STAGE=${WEB_STAGE}
ENV API_BASE_URL=${API_BASE_URL}

RUN corepack enable
WORKDIR /app

COPY package.json yarn.lock .yarnrc.yml ./
COPY packages/web/package.json ./packages/web/
RUN yarn

# Copy source code for dev (will be overridden by volume mount in compose)
COPY packages/web ./packages/web/

EXPOSE ${WEB_PORT}
CMD ["yarn workspace @spenicle/web dev --host 0.0.0.0 --port ${WEB_PORT}"]
